#! /bin/sh -e

echo "Entering code to configure 16550a serial port clock"  >&2

cat << EOF

# load iorw module
insmod iorw

# open interface 
outb 0x2e 0x87
outb 0x2e 0x87
outb 0x2e 0x20 

# configure ports

# 2nd line selects port by 0x2f <address>
# 0x02 = port0
# 0x03 = port1
# 0x06 = port2
# 0x0d = port3 

# last line selects serial clock:
# 0x00 = 1.8462 MHz
# 0x01 = 2 MHz
# 0x02 = 24 MHz
# 0x03 = 14.769 MHz

# port 0
outb 0x2e 0x07
outb 0x2f 0x02
outb 0x2e 0xf0
outb 0x2f 0x03

# port 1
outb 0x2e 0x07
outb 0x2f 0x03
outb 0x2e 0xf0
outb 0x2f 0x03

# port 2
outb 0x2e 0x07
outb 0x2f 0x06
outb 0x2e 0xf0
outb 0x2f 0x03

# port 3
outb 0x2e 0x07
outb 0x2f 0x0d
outb 0x2e 0xf0
outb 0x2f 0x03

EOF
